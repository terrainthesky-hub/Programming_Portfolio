{"pageProps":{"postData":{"id":"2024-1-5-Setting-Up-WebdriverIO-Mocha-Framework-With-Git-Hub-Actions-and-Allure","contentHtml":"<p>There's quite a few different technologies at work, but we're going to assume you have and can use, Git, VS Code, Git Bash. We'll begin starting off with setting up WebdriverIO, Mocha, and Allure.</p>\n<p>In your main directory, in the bash terminal, enter this to begin the instillation of WebdriverIO and Mocha for the WebdriverIO Command Line Interface.</p>\n<pre><code>    npm install @wdio/cli\n</code></pre>\n<p>After, begin the configuration with</p>\n<pre><code>    npx wdio config\n</code></pre>\n<p>These are the following options to choose:</p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/f9bee03f-cda5-429b-9e26-3eb4fb4486cb\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/74a6a37c-ae4a-4405-82b4-4bf314da960e\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/8b9eebcf-a0ab-4b36-91fc-a658be7eacc6\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/3d098dcf-6a2a-4beb-aeb7-1f975d8df201\" alt=\"image\"></p>\n<p>Press space to select:</p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/b2e68906-5679-4102-b1ef-caac80644a06\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/8c250dee-58cc-455b-b0da-8fd67c1d6157\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/b18c700b-fe9e-489e-b18e-8ba136f5bc6f\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/c04a1aff-d2d4-4020-9595-70fcb6d2ca62\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/b2bc33a9-8a59-4855-89b1-bceac0155d38\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/d7b0f5d3-873f-4a85-b05f-5688c22e63c7\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/a7d06830-a53d-42e3-8696-ee7f556751bf\" alt=\"image\"></p>\n<p>Choose more here if you need them:</p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/a5ef8b00-02fb-45c1-a08f-8a461f560357\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/ead8d4d5-655a-44eb-90ac-7fd9caef2449\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/ba955ac4-7097-4acf-811f-a0173d8eaa10\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/3e104f0e-f7cb-4755-ad7b-53d4ae4e6785\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/1c8744ab-716e-4723-afcf-88afc5c27653\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/1283a63e-c627-4319-b14c-cdd2a23cb42b\" alt=\"image\"></p>\n<p>From here you can begin to add tests to your spec files or just use the default ones made in the configuration. Test out the default tests by typing in</p>\n<pre><code>    npm run wdio\n                    \n</code></pre>\n<p>Next, you want to configure your wdio.conf.ts file correctly to work with the runners and services like Docker and Allure. I'm using the default port for docker for now:</p>\n<pre><code>    services: [\n            ['docker', {\n                // Docker options\n                image: 'selenium/standalone-chrome',\n                healthCheck: 'http://localhost:4444',\n                options: {\n                    p: ['4444:4444'],\n                    // Add other Docker options here\n                },\n                // Add other wdio-docker-service configurations here\n            }],\n        ],\n</code></pre>\n<p>Configure your reporter to this:</p>\n<pre><code>    reporters: [\n            'spec',\n            ['allure', {\n              outputDir: 'allure-results',\n              disableWebdriverStepsReporting: true,\n              disableWebdriverScreenshotsReporting: false,\n            }],\n            ],\n</code></pre>\n<p>Next, you'll want to get your package.json file set up for using Allure, Mocha, and Chrome:</p>\n<pre><code>    {\n      \"name\": \"my-new-project\",\n      \"type\": \"module\",\n      \"devDependencies\": {\n        \"@wdio/allure-reporter\": \"^8.27.0\",\n        \"@wdio/cli\": \"^8.26.1\",\n        \"@wdio/local-runner\": \"^8.26.1\",\n        \"@wdio/mocha-framework\": \"^8.24.12\",\n        \"@wdio/spec-reporter\": \"^8.24.2\",\n        \"allure-commandline\": \"^2.25.0\",\n        \"allure-mocha\": \"^2.10.0\",\n        \"chromedriver\": \"^119.0.1\",\n        \"ts-node\": \"^10.9.1\",\n        \"typescript\": \"^5.3.3\",\n        \"wdio-chromedriver-service\": \"^8.1.1\",\n        \"wdio-docker-service\": \"^3.2.1\",\n        \"wdio-wait-for\": \"^3.0.9\"\n      },\n      \"scripts\": {\n        \"wdio\": \"wdio run ./wdio.conf.ts\",\n        \"allure:report\": \"allure generate allure-results --clean\"\n      },\n      \"dependencies\": {\n        \"allure\": \"^0.0.0\",\n        \"string-width\": \"^6.1.0\"\n      },\n      \"mocha\": {\n        \"parallel\": false,\n        \"reporter\": \"allure-mocha\",\n        \"reporterOptions\": {\n          \"resultsDir\": \"allure-results\"\n        }\n      }\n    }\n</code></pre>\n<p>Now you should have Docker installed, and create a Dockerfile with this configuration. Use environment variables to open the port you want:</p>\n<pre><code>    # Use an official Node runtime as a parent image\n    FROM node:latest\n    \n    # Install Chrome for running tests\n    RUN apt-get update &#x26;&#x26; apt-get install -y wget gnupg2\n    RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -\n    RUN sh -c 'echo \"deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main\" >> /etc/apt/sources.list.d/google-chrome.list'\n    RUN apt-get update &#x26;&#x26; apt-get install -y google-chrome-stable\n    \n    # Install other dependencies\n    RUN apt-get install -y libnss3 libgconf-2-4 libfontconfig1\n    \n    # Set the working directory in the container\n    WORKDIR /usr/src/app\n    \n    # Copy the current directory contents into the container at /usr/src/app\n    COPY . .\n\n    # Expose the port dynamically\n    EXPOSE $PORT\n    \n    # Install any needed packages specified in package.json\n    COPY package*.json ./\n    RUN npm install\n    \n    # Run WebdriverIO tests when the container launches\n    CMD [\"npx\", \"wdio\", \"wdio.conf.ts\"]\n</code></pre>\n<p>Next, you'll create a folder called .github which contains a folder called workflows, then create a file called main.yml. Here is the configuration to install ubunutu, build a Docker image, run the Docker image, and share the allure-results folder with your Github Actions CLI. This will use a default security token from Github, and create an artifact that it shares between the Docker Image and the Github Actions CLI:</p>\n<pre><code>    name: CI\n\n    on:\n      push:\n        branches: [ main ]\n      pull_request:\n        branches: [ main ]\n    \n    jobs:\n      build-and-run:\n        runs-on: ubuntu-latest\n    \n        steps:\n        - uses: actions/checkout@v2\n    \n        - name: Build the Docker image\n          run: docker build . --file Dockerfile --tag your-docker-image-name-here\n    \n        - name: Run the Docker image\n          run: docker run -v ${PWD}/allure-results:/usr/src/app/allure-results -p 4444:4444 your-docker-image-name-here || true\n    \n        - name: Upload Allure results\n          uses: actions/upload-artifact@v2\n          with:\n            name: allure-results\n            path: ./allure-results\n      \n        - name: Download Allure results\n          uses: actions/download-artifact@v2\n          with:\n              name: allure-results\n    \n        - name: Install Allure CLI\n          run: npm install -g allure-commandline\n    \n        - name: Generate Allure Report\n          run: npm run allure:report\n    \n        - name: Deploy to GitHub Pages\n          uses: peaceiris/actions-gh-pages@v3\n          with:\n            github_token: ${{ secrets.GITHUB_TOKEN }}\n            publish_dir: ./allure-report\n            publish_branch: gh-pages\n</code></pre>\n<p>To configure github, you'll want to go to the settings and pages, and make sure you have this as set up for the default Github Pages:</p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/9ef54d97-562c-4dc5-a0bf-956a8deb1992\" alt=\"image\"></p>\n<p>Go to settings, Actions, then General and set your permissions to this:</p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/a96f17c2-4fb3-4861-bacc-5e750f946c86\" alt=\"image\"></p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/98454d77-7c7c-4f3e-b6ac-8332e5cc6da0\" alt=\"image\"></p>\n<p>Now in your bash terminal do \"git add .\", then git commit -m \"your commit name\", and git push to see it run your Docker container, test suite, and create your allure report on the gh-pages branch hosted by github pages. I have a purposefully added a failed test to show it will run even if one of the tests fails:</p>\n<p><img src=\"https://github.com/terrainthesky-hub/terrainthesky-hub.github.io/assets/60892621/624f4825-042c-4a3b-9419-6b10626bf4d2\" alt=\"image\"></p>\n<p>Now you can configure Allure, the framework, and other github permissions as needed.</p>\n","layout":"post","title":"Setting up WebdriverIO Mocha Framework With Docker, GitHub Actions and Allure.","subtitle":"WebdriverIO, npm, Typescript, Mocha, Docker, Github Actions, Allure"}},"__N_SSG":true}